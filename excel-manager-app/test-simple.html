<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç®€åŒ–æµ‹è¯•ç‰ˆ</title>
</head>
<body>
    <h1>æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h1>
    <input type="file" id="testFileInput" accept=".xlsx,.xls,.csv">
    <div id="testOutput"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        console.log('ğŸ¯ ç®€åŒ–æµ‹è¯•é¡µé¢åŠ è½½');
        console.log('ğŸ” XLSXåº“çŠ¶æ€:', typeof XLSX !== 'undefined' ? 'âœ…å·²åŠ è½½' : 'âŒæœªåŠ è½½');

        document.getElementById('testFileInput').addEventListener('change', function(e) {
            console.log('ğŸ¯ æ–‡ä»¶é€‰æ‹©äº‹ä»¶è§¦å‘');
            const file = e.target.files[0];
            if (file) {
                console.log('ğŸ“ é€‰æ‹©çš„æ–‡ä»¶:', file.name, 'å¤§å°:', file.size, 'ç±»å‹:', file.type);
                document.getElementById('testOutput').innerHTML = `
                    <p>âœ… æ–‡ä»¶é€‰æ‹©æˆåŠŸ!</p>
                    <p>æ–‡ä»¶å: ${file.name}</p>
                    <p>å¤§å°: ${(file.size/1024).toFixed(2)} KB</p>
                    <p>ç±»å‹: ${file.type}</p>
                `;
                
                // æµ‹è¯•æ–‡ä»¶è¯»å–
                testFileReading(file);
            }
        });

        function testFileReading(file) {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ–‡ä»¶è¯»å–...');
            
            if (file.name.toLowerCase().endsWith('.csv')) {
                // æµ‹è¯•CSVè¯»å–
                const reader = new FileReader();
                reader.onload = function(e) {
                    console.log('ğŸ“„ CSVæ–‡ä»¶è¯»å–æˆåŠŸï¼Œå†…å®¹é•¿åº¦:', e.target.result.length);
                    document.getElementById('testOutput').innerHTML += '<p>âœ… CSVæ–‡ä»¶è¯»å–æˆåŠŸ!</p>';
                };
                reader.onerror = function() {
                    console.error('âŒ CSVæ–‡ä»¶è¯»å–å¤±è´¥');
                    document.getElementById('testOutput').innerHTML += '<p>âŒ CSVæ–‡ä»¶è¯»å–å¤±è´¥!</p>';
                };
                reader.readAsText(file);
                
            } else if (file.name.toLowerCase().match(/\.(xlsx|xls)$/)) {
                // æµ‹è¯•Excelè¯»å–
                if (typeof XLSX === 'undefined') {
                    console.error('âŒ XLSXåº“æœªåŠ è½½');
                    document.getElementById('testOutput').innerHTML += '<p>âŒ XLSXåº“æœªåŠ è½½!</p>';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        console.log('ğŸ“Š å¼€å§‹è§£æExcelæ–‡ä»¶...');
                        const workbook = XLSX.read(e.target.result, {type: 'array'});
                        console.log('ğŸ“Š Excelè§£ææˆåŠŸï¼Œå·¥ä½œè¡¨:', workbook.SheetNames);
                        document.getElementById('testOutput').innerHTML += `<p>âœ… Excelæ–‡ä»¶è¯»å–æˆåŠŸ! å·¥ä½œè¡¨: ${workbook.SheetNames.join(', ')}</p>`;
                    } catch (error) {
                        console.error('âŒ Excelè§£æå¤±è´¥:', error);
                        document.getElementById('testOutput').innerHTML += `<p>âŒ Excelè§£æå¤±è´¥: ${error.message}</p>`;
                    }
                };
                reader.onerror = function() {
                    console.error('âŒ Excelæ–‡ä»¶è¯»å–å¤±è´¥');
                    document.getElementById('testOutput').innerHTML += '<p>âŒ Excelæ–‡ä»¶è¯»å–å¤±è´¥!</p>';
                };
                reader.readAsArrayBuffer(file);
            }
        }
    </script>
</body>
</html>